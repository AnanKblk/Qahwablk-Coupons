<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QahwaBLK Coupon System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
const { useState, useEffect } = React;

const BRANCHES = ['7th Circle [PoS]','Abdali Boulevard [PoS]','Abdoun Circle [PoS]','Abdoun [PoS]','Airport Arrivals [PoS]','Al Hujra [PoS]','Al Yasmeen [PoS]','Al-Ahliyya University [PoS]','Bayader [PoS]','Fuhais [PoS]','Ghosheh Street [PoS]','Hashemite University 1 [PoS]','Hurriyeh Street [PoS]','Jordan University 1 (Clock Tower) [PoS]','Jordan University 2 (Medicine) [PoS]','Khalda [PoS]','Kia Showroom [PoS]','Petra [PoS]','Sports City [PoS]','Sweifiyeh [PoS]','Sweileh [PoS]','Total - Esra\'a ( Airport Road ) [PoS]','Total - Wadi Saqraa [PoS]','Training Branch [PoS]','University Street 1 [PoS]','University Street 2 [PoS]','Zarqa - Autostrad [PoS]','Zarqa - Karama [PoS]'].sort();

const ADMIN_PIN = '2025';

const Upload = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>;
const Plus = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>;
const X = () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>;
const Check = () => <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>;
const AlertCircle = () => <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
const Download = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>;
const Key = () => <svg className="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" /></svg>;
const Store = () => <svg className="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>;

const App = () => {
  const [mode, setMode] = useState('select');
  const [coupons, setCoupons] = useState([]);
  const [loading, setLoading] = useState(true);
  const [selectedBranch, setSelectedBranch] = useState('');
  const [isAdminAuthenticated, setIsAdminAuthenticated] = useState(false);
  const [adminPin, setAdminPin] = useState('');
  const [showPinModal, setShowPinModal] = useState(false);
  const [reportEmails, setReportEmails] = useState(['manager@qahwablk.com', 'finance@qahwablk.com']);
  const [showEmailConfig, setShowEmailConfig] = useState(false);
  const [showImport, setShowImport] = useState(false);
  const [showCreate, setShowCreate] = useState(false);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterStatus, setFilterStatus] = useState('all');
  const [couponCode, setCouponCode] = useState('');
  const [validationResult, setValidationResult] = useState(null);

  useEffect(() => {
    loadCoupons();
  }, []);

  const loadCoupons = () => {
    setLoading(true);
    try {
      const data = localStorage.getItem('qahwablk_coupons');
      if (data) setCoupons(JSON.parse(data));
    } catch (error) {
      console.log('No coupons found');
    }
    setLoading(false);
  };

  const saveCoupons = (newCoupons) => {
    localStorage.setItem('qahwablk_coupons', JSON.stringify(newCoupons));
    setCoupons(newCoupons);
  };

  const handleExcelImport = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (event) => {
      const text = event.target.result;
      const lines = text.split('\n').filter(line => line.trim());
      const dataLines = lines.slice(1);
      const imported = dataLines.map(line => {
        const [code, value, campaign, activationDate, expiryDate, status] = line.split(',').map(s => s.trim());
        return {
          id: Date.now() + Math.random(),
          code: code || '',
          value: parseFloat(value) || 0,
          campaign: campaign || 'Uncategorized',
          activationDate: activationDate || new Date().toISOString().split('T')[0],
          expiryDate: expiryDate || '',
          status: status?.toLowerCase() === 'active' ? 'active' : 'inactive',
          used: false,
          usedAt: null,
          usedBranch: null
        };
      }).filter(c => c.code);
      saveCoupons([...coupons, ...imported]);
      setShowImport(false);
      alert(`Imported ${imported.length} coupons successfully!`);
    };
    reader.readAsText(file);
  };

  const createCoupon = (formData) => {
    const newCoupon = {
      id: Date.now(),
      code: formData.code,
      value: parseFloat(formData.value),
      campaign: formData.campaign,
      activationDate: formData.activationDate,
      expiryDate: formData.expiryDate,
      status: 'active',
      used: false,
      usedAt: null,
      usedBranch: null
    };
    saveCoupons([...coupons, newCoupon]);
    setShowCreate(false);
  };

  const toggleCouponStatus = (id) => {
    const updated = coupons.map(c => c.id === id ? { ...c, status: c.status === 'active' ? 'inactive' : 'active' } : c);
    saveCoupons(updated);
  };

  const deleteCoupon = (id) => {
    if (confirm('Delete this coupon?')) {
      saveCoupons(coupons.filter(c => c.id !== id));
    }
  };

  const validateAndRedeem = () => {
    if (!selectedBranch) {
      setValidationResult({ valid: false, message: 'Please select a branch first' });
      return;
    }
    const coupon = coupons.find(c => c.code.toLowerCase() === couponCode.toLowerCase());
    if (!coupon) {
      setValidationResult({ valid: false, message: 'Coupon code not found' });
      return;
    }
    if (coupon.used) {
      setValidationResult({ valid: false, message: `Already used at ${coupon.usedBranch} on ${new Date(coupon.usedAt).toLocaleString()}` });
      return;
    }
    if (coupon.status === 'inactive') {
      setValidationResult({ valid: false, message: 'Coupon is not active' });
      return;
    }
    const today = new Date().toISOString().split('T')[0];
    if (coupon.activationDate && today < coupon.activationDate) {
      setValidationResult({ valid: false, message: 'Coupon not yet active' });
      return;
    }
    if (coupon.expiryDate && today > coupon.expiryDate) {
      setValidationResult({ valid: false, message: 'Coupon expired' });
      return;
    }
    const updated = coupons.map(c => c.id === coupon.id ? {...c, used: true, usedAt: new Date().toISOString(), usedBranch: selectedBranch} : c);
    saveCoupons(updated);
    setValidationResult({ valid: true, message: `${coupon.value} JOD OFF`, campaign: coupon.campaign, redeemed: true });
    setTimeout(() => {
      setCouponCode('');
      setValidationResult(null);
    }, 3000);
  };

  const checkCouponOnly = () => {
    const coupon = coupons.find(c => c.code.toLowerCase() === couponCode.toLowerCase());
    if (!coupon) {
      setValidationResult({ valid: false, message: 'Coupon code not found in system', checkOnly: true });
      return;
    }
    if (coupon.used) {
      setValidationResult({ valid: false, message: `Already used at ${coupon.usedBranch} on ${new Date(coupon.usedAt).toLocaleString()}`, checkOnly: true });
      return;
    }
    if (coupon.status === 'inactive') {
      setValidationResult({ valid: false, message: 'Coupon is not active', checkOnly: true });
      return;
    }
    const today = new Date().toISOString().split('T')[0];
    if (coupon.activationDate && today < coupon.activationDate) {
      setValidationResult({ valid: false, message: `Not yet active. Starts: ${coupon.activationDate}`, checkOnly: true });
      return;
    }
    if (coupon.expiryDate && today > coupon.expiryDate) {
      setValidationResult({ valid: false, message: `Expired on ${coupon.expiryDate}`, checkOnly: true });
      return;
    }
    setValidationResult({ valid: true, message: `${coupon.value} JOD OFF`, campaign: coupon.campaign, checkOnly: true, activationDate: coupon.activationDate, expiryDate: coupon.expiryDate });
  };

  const exportToExcel = () => {
    const csv = ['Code,Value,Campaign,Activation Date,Expiry Date,Status,Used,Used At,Used Branch', ...coupons.map(c => `${c.code},${c.value},${c.campaign},${c.activationDate},${c.expiryDate},${c.status},${c.used},${c.usedAt || ''},${c.usedBranch || ''}`)].join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `qahwablk-coupons-${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
  };

  const downloadTemplate = () => {
    const template = 'Code,Value,Campaign,Activation Date,Expiry Date,Status\nSAMPLE001,5,Summer Promo,2025-03-01,2025-03-31,active\nSAMPLE002,3,Social Media,2025-02-15,2025-02-28,active';
    const blob = new Blob([template], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'coupon-import-template.csv';
    a.click();
  };

  const generateDailyReport = () => {
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const yesterdayStr = yesterday.toISOString().split('T')[0];
    const yesterdayCoupons = coupons.filter(c => {
      if (!c.used || !c.usedAt) return false;
      return new Date(c.usedAt).toISOString().split('T')[0] === yesterdayStr;
    });
    if (yesterdayCoupons.length === 0) {
      alert('No coupons were redeemed yesterday.');
      return;
    }
    const reportLines = ['=== QAHWABLK DAILY COUPON REPORT ===', `Date: ${yesterdayStr}`, `Total Redeemed: ${yesterdayCoupons.length} coupons`, `Total Discount Value: ${yesterdayCoupons.reduce((sum, c) => sum + c.value, 0)} JOD`, '', '=== BREAKDOWN BY BRANCH ===', ''];
    const byBranch = {};
    yesterdayCoupons.forEach(c => {
      if (!byBranch[c.usedBranch]) byBranch[c.usedBranch] = [];
      byBranch[c.usedBranch].push(c);
    });
    Object.keys(byBranch).sort().forEach(branch => {
      const branchCoupons = byBranch[branch];
      const branchTotal = branchCoupons.reduce((sum, c) => sum + c.value, 0);
      reportLines.push(`${branch}: ${branchCoupons.length} coupons, ${branchTotal} JOD`);
      branchCoupons.forEach(c => {
        reportLines.push(`  - ${c.code} (${c.value} JOD, ${c.campaign}) at ${new Date(c.usedAt).toLocaleTimeString()}`);
      });
      reportLines.push('');
    });
    reportLines.push('=== EMAIL TO ===');
    reportEmails.forEach(email => reportLines.push(email));
    reportLines.push('', '--- Detailed CSV Export Below ---', 'Code,Value,Campaign,Branch,Used At');
    yesterdayCoupons.forEach(c => {
      reportLines.push(`${c.code},${c.value},${c.campaign},${c.usedBranch},${new Date(c.usedAt).toLocaleString()}`);
    });
    const reportText = reportLines.join('\n');
    const blob = new Blob([reportText], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `QahwaBLK-Daily-Report-${yesterdayStr}.txt`;
    a.click();
    alert(`Report generated!\n${yesterdayCoupons.length} coupons redeemed yesterday.`);
  };

  const handleAdminLogin = () => {
    if (adminPin === ADMIN_PIN) {
      setIsAdminAuthenticated(true);
      setShowPinModal(false);
      setMode('admin');
      setAdminPin('');
    } else {
      alert('Incorrect PIN');
      setAdminPin('');
    }
  };

  const filteredCoupons = coupons.filter(c => {
    const matchesSearch = c.code.toLowerCase().includes(searchTerm.toLowerCase()) || c.campaign.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesFilter = filterStatus === 'all' || (filterStatus === 'active' && c.status === 'active' && !c.used) || (filterStatus === 'used' && c.used) || (filterStatus === 'inactive' && c.status === 'inactive');
    return matchesSearch && matchesFilter;
  });

  if (loading) {
    return <div className="flex items-center justify-center h-screen bg-white"><div className="text-center"><div className="animate-spin rounded-full h-12 w-12 border-b-2 border-black mx-auto"></div><p className="mt-4 text-gray-600">Loading QahwaBLK Coupon System...</p></div></div>;
  }

  if (mode === 'select') {
    return (
      <div className="min-h-screen bg-white flex items-center justify-center p-4">
        <div className="max-w-4xl w-full">
          <div className="text-center mb-12">
            <h1 className="text-5xl font-bold text-black mb-2" style={{fontFamily: 'Arial Black', letterSpacing: '2px'}}>QahwaBLK</h1>
            <p className="text-xl text-gray-700">Coupon Management System</p>
          </div>
          <div className="grid md:grid-cols-2 gap-6">
            <button onClick={() => setShowPinModal(true)} className="bg-black text-white p-8 rounded-2xl shadow-lg hover:shadow-xl transition-all group">
              <Key />
              <h2 className="text-2xl font-bold mb-2">Admin Panel</h2>
              <p className="text-gray-300">Manage coupons, import codes, and view reports</p>
              <p className="text-xs text-red-400 mt-2">‚ö†Ô∏è PIN Required</p>
            </button>
            <button onClick={() => setMode('cashier')} className="bg-white border-2 border-black p-8 rounded-2xl shadow-lg hover:shadow-xl transition-all group">
              <Store />
              <h2 className="text-2xl font-bold text-black mb-2">Cashier</h2>
              <p className="text-gray-700">Redeem customer coupons at checkout</p>
            </button>
          </div>
          <div className="text-center mt-8 text-gray-500 text-sm">{coupons.length} total coupons ‚Ä¢ {coupons.filter(c => !c.used && c.status === 'active').length} available</div>
        </div>
        {showPinModal && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div className="bg-white rounded-lg p-6 max-w-sm w-full border-2 border-black">
              <div className="flex justify-between items-center mb-4">
                <h3 className="text-xl font-bold">Admin Access</h3>
                <button onClick={() => { setShowPinModal(false); setAdminPin(''); }}><X /></button>
              </div>
              <p className="text-sm text-gray-600 mb-4">Enter admin PIN to access management panel</p>
              <input type="password" value={adminPin} onChange={(e) => setAdminPin(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleAdminLogin()} placeholder="Enter PIN" className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent text-center text-xl font-mono mb-4" autoFocus />
              <button onClick={handleAdminLogin} className="w-full py-3 bg-black text-white rounded-lg font-bold hover:bg-gray-800 transition-colors">Login</button>
            </div>
          </div>
        )}
      </div>
    );
  }

  if (mode === 'cashier') {
    return (
      <div className="min-h-screen bg-white flex items-center justify-center p-4">
        <div className="max-w-2xl w-full">
          <button onClick={() => setMode('select')} className="mb-4 text-gray-700 hover:text-black font-medium">‚Üê Back to Home</button>
          <div className="bg-white rounded-2xl shadow-xl border-2 border-black p-8">
            <h1 className="text-3xl font-bold text-black mb-6 text-center">Redeem Coupon</h1>
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">Select Branch</label>
              <select value={selectedBranch} onChange={(e) => setSelectedBranch(e.target.value)} className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent text-lg">
                <option value="">-- Select Your Branch --</option>
                {BRANCHES.map(branch => <option key={branch} value={branch}>{branch}</option>)}
              </select>
            </div>
            <div className="mb-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">Enter Coupon Code</label>
              <input type="text" value={couponCode} onChange={(e) => setCouponCode(e.target.value.toUpperCase())} onKeyPress={(e) => e.key === 'Enter' && validateAndRedeem()} placeholder="ENTER CODE" disabled={!selectedBranch} className="w-full px-4 py-4 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent text-xl font-mono text-center uppercase" />
            </div>
            <div className="grid grid-cols-2 gap-3 mb-4">
              <button onClick={checkCouponOnly} disabled={!couponCode} className="py-4 bg-gray-200 text-black border-2 border-black rounded-lg font-bold text-lg hover:bg-gray-300 disabled:bg-gray-100 disabled:border-gray-300 disabled:text-gray-400 disabled:cursor-not-allowed transition-colors">üîç CHECK COUPON</button>
              <button onClick={validateAndRedeem} disabled={!selectedBranch || !couponCode} className="py-4 bg-black text-white rounded-lg font-bold text-lg hover:bg-gray-800 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors">‚úì REDEEM</button>
            </div>
            <p className="text-xs text-gray-500 text-center">Use "Check" to verify without redeeming ‚Ä¢ Use "Redeem" to apply discount</p>
            {validationResult && (
              <div className={`mt-6 p-6 rounded-lg ${validationResult.valid ? validationResult.checkOnly ? 'bg-gray-100 border-2 border-gray-400' : 'bg-white border-2 border-black' : 'bg-gray-50 border-2 border-gray-600'}`}>
                <div className="flex items-center gap-3">
                  {validationResult.valid ? <Check /> : <AlertCircle />}
                  <div className="flex-1">
                    <div className="text-2xl font-bold text-black">{validationResult.valid ? validationResult.checkOnly ? '‚úì VALID COUPON' : '‚úì REDEEMED' : '‚úó INVALID'}</div>
                    <div className="text-xl text-gray-700">{validationResult.message}</div>
                    {validationResult.campaign && <div className="text-sm text-gray-600 mt-1">Campaign: {validationResult.campaign}</div>}
                    {validationResult.checkOnly && validationResult.valid && (
                      <div className="mt-3 p-3 bg-white rounded border-2 border-gray-300">
                        <div className="text-xs text-gray-600 space-y-1">
                          {validationResult.activationDate && <div>Active from: {validationResult.activationDate}</div>}
                          {validationResult.expiryDate && <div>Expires: {validationResult.expiryDate}</div>}
                          <div className="font-semibold text-gray-900 mt-2">‚ÑπÔ∏è Not redeemed - coupon still available</div>
                        </div>
                      </div>
                    )}
                    {validationResult.redeemed && <div className="mt-2 text-sm font-semibold text-black">‚úì Successfully redeemed at {selectedBranch}</div>}
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    );
  }

  if (mode === 'admin') {
    if (!isAdminAuthenticated) { setMode('select'); return null; }
    return (
      <div className="min-h-screen bg-gray-50">
        <div className="bg-black text-white p-4 shadow-lg">
          <div className="max-w-7xl mx-auto flex justify-between items-center">
            <div><h1 className="text-2xl font-bold">QahwaBLK Admin Panel</h1><p className="text-gray-300 text-sm">Coupon Management</p></div>
            <button onClick={() => { setMode('select'); setIsAdminAuthenticated(false); }} className="px-4 py-2 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors">Logout</button>
          </div>
        </div>
        <div className="max-w-7xl mx-auto p-6">
          <div className="flex flex-wrap gap-3 mb-6">
            <button onClick={() => setShowImport(true)} className="flex items-center gap-2 px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors"><Upload />Import Excel</button>
            <button onClick={() => setShowCreate(true)} className="flex items-center gap-2 px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors"><Plus />Create Coupon</button>
            <button onClick={generateDailyReport} className="flex items-center gap-2 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors"><Download />üìß Daily Report</button>
            <button onClick={exportToExcel} className="flex items-center gap-2 px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors"><Download />Export All</button>
            <button onClick={downloadTemplate} className="flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500 transition-colors"><Download />Template</button>
            <button onClick={() => setShowEmailConfig(true)} className="flex items-center gap-2 px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-400 transition-colors">‚öôÔ∏è Emails</button>
          </div>
          <div className="bg-white p-4 rounded-lg shadow border border-gray-200 mb-6">
            <div className="flex flex-wrap gap-4">
              <input type="text" placeholder="Search by code or campaign..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="flex-1 min-w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent" />
              <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)} className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black focus:border-transparent">
                <option value="all">All Coupons</option><option value="active">Active</option><option value="used">Used</option><option value="inactive">Inactive</option>
              </select>
            </div>
          </div>
          <div className="grid grid-cols-4 gap-4 mb-6">
            <div className="bg-white p-4 rounded-lg shadow border-2 border-black"><div className="text-2xl font-bold text-black">{coupons.length}</div><div className="text-sm text-gray-600">Total Coupons</div></div>
            <div className="bg-white p-4 rounded-lg shadow border border-gray-300"><div className="text-2xl font-bold text-black">{coupons.filter(c => !c.used && c.status === 'active').length}</div><div className="text-sm text-gray-600">Available</div></div>
            <div className="bg-white p-4 rounded-lg shadow border border-gray-300"><div className="text-2xl font-bold text-black">{coupons.filter(c => c.used).length}</div><div className="text-sm text-gray-600">Redeemed</div></div>
            <div className="bg-white p-4 rounded-lg shadow border border-gray-300"><div className="text-2xl font-bold text-black">{coupons.filter(c => c.used).reduce((sum, c) => sum + c.value, 0)} JOD</div><div className="text-sm text-gray-600">Total Discounts</div></div>
          </div>
          <div className="bg-white rounded-lg shadow border border-gray-200 overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Code</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Value</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Campaign</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Active</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Expiry</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                    <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                  {filteredCoupons.map(coupon => (
                    <tr key={coupon.id} className="hover:bg-gray-50">
                      <td className="px-4 py-3 font-mono text-sm">{coupon.code}</td>
                      <td className="px-4 py-3 font-semibold">{coupon.value} JOD</td>
                      <td className="px-4 py-3 text-sm">{coupon.campaign}</td>
                      <td className="px-4 py-3 text-sm">{coupon.activationDate}</td>
                      <td className="px-4 py-3 text-sm">{coupon.expiryDate || 'No expiry'}</td>
                      <td className="px-4 py-3">
                        {coupon.used ? <span className="px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800">Used - {coupon.usedBranch}</span> : coupon.status === 'active' ? <span className="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Active</span> : <span className="px-2 py-1 text-xs rounded-full bg-red-100 text-red-800">Inactive</span>}
                      </td>
                      <td className="px-4 py-3">
                        <div className="flex gap-2">
                          {!coupon.used && <button onClick={() => toggleCouponStatus(coupon.id)} className={`px-3 py-1 text-xs rounded ${coupon.status === 'active' ? 'bg-red-100 text-red-700 hover:bg-red-200' : 'bg-green-100 text-green-700 hover:bg-green-200'}`}>{coupon.status === 'active' ? 'Deactivate' : 'Activate'}</button>}
                          <button onClick={() => deleteCoupon(coupon.id)} className="px-3 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200">Delete</button>
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>
        {showImport && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div className="bg-white rounded-lg p-6 max-w-md w-full border-2 border-black">
              <div className="flex justify-between items-center mb-4"><h3 className="text-xl font-bold">Import Coupons</h3><button onClick={() => setShowImport(false)}><X /></button></div>
              <div className="mb-4"><p className="text-sm text-gray-600 mb-2">Upload CSV: Code, Value, Campaign, Activation Date, Expiry Date, Status</p><input type="file" accept=".csv" onChange={handleExcelImport} className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg" /></div>
              <button onClick={downloadTemplate} className="w-full px-4 py-2 bg-gray-200 border-2 border-black text-black rounded-lg hover:bg-gray-300">Download Template First</button>
            </div>
          </div>
        )}
        {showCreate && <CreateCouponModal onClose={() => setShowCreate(false)} onCreate={createCoupon} />}
        {showEmailConfig && <EmailConfigModal emails={reportEmails} onClose={() => setShowEmailConfig(false)} onSave={(newEmails) => { setReportEmails(newEmails); setShowEmailConfig(false); }} />}
      </div>
    );
  }
};

const CreateCouponModal = ({ onClose, onCreate }) => {
  const [formData, setFormData] = useState({code: '', value: '', campaign: '', activationDate: new Date().toISOString().split('T')[0], expiryDate: ''});
  const handleSubmit = () => {
    if (!formData.code || !formData.value || !formData.campaign) {
      alert('Please fill in all required fields');
      return;
    }
    onCreate(formData);
  };
  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
      <div className="bg-white rounded-lg p-6 max-w-md w-full border-2 border-black">
        <div className="flex justify-between items-center mb-4"><h3 className="text-xl font-bold">Create New Coupon</h3><button onClick={onClose}><X /></button></div>
        <div className="space-y-4">
          <div><label className="block text-sm font-medium text-gray-700 mb-1">Coupon Code *</label><input type="text" value={formData.code} onChange={(e) => setFormData({...formData, code: e.target.value.toUpperCase()})} className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg font-mono" placeholder="SUMMER2025" /></div>
          <div><label className="block text-sm font-medium text-gray-700 mb-1">Discount Value (JOD) *</label><input type="number" step="0.01" value={formData.value} onChange={(e) => setFormData({...formData, value: e.target.value})} className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg" placeholder="5" /></div>
          <div><label className="block text-sm font-medium text-gray-700 mb-1">Campaign Name *</label><input type="text" value={formData.campaign} onChange={(e) => setFormData({...formData, campaign: e.target.value})} className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg" placeholder="Summer Promotion" /></div>
          <div><label className="block text-sm font-medium text-gray-700 mb-1">Activation Date</label><input type="date" value={formData.activationDate} onChange={(e) => setFormData({...formData, activationDate: e.target.value})} className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg" /></div>
          <div><label className="block text-sm font-medium text-gray-700 mb-1">Expiry Date (optional)</label><input type="date" value={formData.expiryDate} onChange={(e) => setFormData({...formData, expiryDate: e.target.value})} className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg" /></div>
          <div className="flex gap-3 pt-4">
            <button onClick={onClose} className="flex-1 px-4 py-2 bg-white border-2 border-black text-black rounded-lg hover:bg-gray-100">Cancel</button>
            <button onClick={handleSubmit} className="flex-1 px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800">Create Coupon</button>
          </div>
        </div>
      </div>
    </div>
  );
};

const EmailConfigModal = ({ emails, onClose, onSave }) => {
  const [emailList, setEmailList] = useState(emails.join('\n'));
  const handleSave = () => {
    const newEmails = emailList.split('\n').map(e => e.trim()).filter(e => e);
    if (newEmails.length === 0) {
      alert('Please enter at least one email address');
      return;
    }
    onSave(newEmails);
  };
  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
      <div className="bg-white rounded-lg p-6 max-w-md w-full border-2 border-black">
        <div className="flex justify-between items-center mb-4"><h3 className="text-xl font-bold">Daily Report Email Recipients</h3><button onClick={onClose}><X /></button></div>
        <div className="space-y-4">
          <div><label className="block text-sm font-medium text-gray-700 mb-2">Email Addresses (one per line)</label><textarea value={emailList} onChange={(e) => setEmailList(e.target.value)} rows={6} placeholder="manager@qahwablk.com&#10;finance@qahwablk.com" className="w-full px-3 py-2 border-2 border-gray-300 rounded-lg font-mono text-sm" /><p className="text-xs text-gray-500 mt-1">These emails will be shown in the daily report.</p></div>
          <div className="flex gap-3">
            <button onClick={onClose} className="flex-1 px-4 py-2 bg-white border-2 border-black text-black rounded-lg hover:bg-gray-100">Cancel</button>
            <button onClick={handleSave} className="flex-1 px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800">Save</button>
          </div>
        </div>
      </div>
    </div>
  );
};

ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
